# Piper 机械臂 ROS 功能包 - 项目说明

## 项目概述

这是一个基于 ROS Noetic 的 Piper 机械臂控制功能包，主要用于通过 CAN 总线实现主从机械臂系统的通信和控制。该项目支持双臂协作场景，能够读取主从臂的状态数据，并可通过 ROS 话题对从臂进行控制。

## 主要功能

### 1. CAN 总线通信
- 支持通过 USB 转 CAN 模块与机械臂通信
- 支持多个 CAN 设备同时连接
- 提供自动化脚本配置 CAN 设备和波特率（1000000）
- 支持自定义 CAN 设备命名（如 can_left, can_right）

### 2. 双臂系统支持
该功能包设计用于控制左右两条机械臂，每条臂包含：
- **主臂（Master）**：用于人工遥操作或发送控制指令
- **从臂（Puppet/Slave）**：执行控制指令的机械臂

### 3. 两种工作模式

#### 模式 0：数据采集模式
- 读取主臂和从臂的关节状态
- 主从臂通过航插线连接，从臂跟随主臂运动
- 发布以下话题：
  - `/master/joint_left` - 左侧主臂关节状态
  - `/master/joint_right` - 右侧主臂关节状态
  - `/puppet/joint_left` - 左侧从臂关节状态
  - `/puppet/joint_right` - 右侧从臂关节状态
- 适用场景：数据采集、示教录制

#### 模式 1：ROS 控制模式
- 通过 ROS 话题控制从臂运动
- **需要断开主臂航插连接**
- 支持使能控制（通过 `/enable_flag` 话题）
- 发布控制话题：
  - `/master/joint_left` - 发送左侧从臂控制指令
  - `/master/joint_right` - 发送右侧从臂控制指令
- 接收反馈话题：
  - `/puppet/joint_left` - 左侧从臂状态反馈
  - `/puppet/joint_right` - 右侧从臂状态反馈
- 适用场景：自动化控制、轨迹复现

### 4. 机械臂控制功能

提供以下服务接口：
- **回零功能**：`/can_left/go_zero_master`, `/can_right/go_zero_master`
  - 让主从臂回到零位
  - 需要主从臂物理连接

- **模式切换**：`/can_left/restore_ms_mode`, `/can_right/restore_ms_mode`
  - 从回零模式恢复到主从控制模式
  - 恢复遥操作功能

### 5. 自定义消息类型

#### PiperStatusMsg
机械臂状态反馈消息，包含：
- 控制模式、臂状态、运动状态
- 各关节角度限位状态
- 各关节通信状态
- 错误代码

#### PosCmd
末端位姿控制消息，支持：
- 笛卡尔空间坐标（x, y, z）
- 姿态角（roll, pitch, yaw）
- 夹爪控制
- 运动模式参数

## 技术架构

- **操作系统**：Ubuntu 20.04
- **ROS 版本**：Noetic
- **通信协议**：CAN 总线
- **Python 依赖**：
  - python-can：CAN 总线通信库
  - piper_sdk：Piper 机械臂 SDK

## 典型应用场景

1. **机器人示教学习**：使用模式 0 采集主臂操作数据，训练机器学习模型
2. **双臂协作任务**：控制左右两条机械臂完成复杂的双手操作任务
3. **轨迹复现**：采集示教数据后，使用模式 1 让从臂自动重复执行
4. **远程操控**：通过 ROS 网络实现机械臂的远程控制

## 核心组件

- **CAN 配置脚本**：`can_activate.sh` - 激活和配置 CAN 设备
- **设备查找脚本**：`find_all_can_port.sh` - 查找所有 CAN 端口
- **主从节点脚本**：`piper_start_ms_node.py` - 主从臂控制节点
- **启动文件**：`start_ms_piper.launch` - 双臂系统启动配置
- **消息包**：`piper_msgs` - 自定义 ROS 消息定义

## 安全注意事项

1. 必须先激活 CAN 设备并设置正确的波特率
2. ROS 控制模式（mode=1）下必须断开主臂航插
3. 控制从臂前必须先发送使能信号
4. 回零后需要调用恢复服务才能进行遥操作
5. 注意区分数据话题和控制话题的用途

## 项目状态

- 测试状态：通过
- 支持平台：Ubuntu 20.04 + ROS Noetic
- 维护状态：活跃开发中
